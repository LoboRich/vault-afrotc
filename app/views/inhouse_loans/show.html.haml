
.app.align-content-stretch.d-flex.flex-wrap
  .app-sidebar
    = render "layouts/sidebar"
  .app-container
    .app-content
      .content-wrapper
        .container
          .page-description.d-flex.align-items-center
            .page-description-content.flex-grow-1
              %h1= @inhouse_loan.client.name
          .row
            .card
              .card-body
                = form_for @inhouse_loan do |f|
                  - if @inhouse_loan.errors.any?
                    #error_explanation
                      %h2= "#{pluralize(@inhouse_loan.errors.count, "error")} prohibited this inhouse_loan from being saved:"
                      %ul
                        - @inhouse_loan.errors.full_messages.each do |message|
                          %li= message
                  .row.m-t-sm
                    .col-md-4
                      = f.label :client
                      = f.text_field :client, class: 'form-control', required:  true, disabled: true, value: @inhouse_loan.client.name
                    .col-md-4
                      = f.label :downpayment
                      = f.text_field :downpayment, class: 'form-control', required:  true, disabled: true
                    .col-md-4
                      = f.label :terms
                      = f.number_field :terms, class: 'form-control', required:  true, disabled: true
                  .row.m-t-sm
                    .col-md-4
                      = f.label :loan_financing
                      = f.text_field :loan_financing, class: 'form-control', required:  true, disabled: true
                    .col-md-4
                      = f.label :balance
                      = f.text_field :balance, class: 'form-control', required:  true, disabled: true
                    .col-md-4
                      = f.label "Factor table"
                      = f.text_field :processing_fees, class: 'form-control', required:  true, disabled: true
                  .row.m-t-sm
                    .col-md-4
                      = f.label :interest
                      = f.text_field :interest, class: 'form-control', required:  true, disabled: true
                    .col-md-4
                      = f.label :monthly_amort
                      = f.text_field :monthly_amort, class: 'form-control', required:  true, disabled: true
                  .row.m-t-sm
                    
                    .col-md-4
                      = f.label :contract_date
                      = f.datetime_field :contract_date, class: 'form-control', required:  true, disabled: true
                    .col-md-4
                      = f.label :amortization_start_date
                      = f.datetime_field :amortization_start_date, class: 'form-control', required:  true, disabled: true
                  .row.m-t-sm
                    .col-md-4
                      = f.label :remarks
                      = f.text_area :remarks, class: 'form-control', required:  true, disabled: true
                  .card-footer.pt-3
                    = link_to 'Back', inhouse_loans_path, :class => "btn btn-secondary"
                    // = link_to 'Edit', edit_inhouse_loan_path(@inhouse_loan), :class => "btn btn-warning float-right"
            .card
              .card-header  
                .page-description.d-flex.align-items-center
                  .page-description-content.flex-grow-1
                    %h1 Statement of Account
                  .page-description-actions
                    = link_to pay_inhouse_loan_path(@inhouse_loan), class: 'btn btn-primary' do
                      %i.material-icons> add
                      Payment
              .card-body
                .table-responsive
                  %table#datatable1.display.dataTable{"aria-describedby" => "datatable1_info", :role => "grid", :style => "width: 100%;"}
                    %thead
                      %tr
                        %th #
                        %th Due Date
                        %th PMT. Date
                        %th OR
                        %th Amount
                        %th ITP
                        %th M.A
                        %th PEN
                        %th Interest
                        %th Principal
                        %th Balance
                        %th Status

                    %tbody
                      %tr
                        %td
                        %td
                        %td
                        %td
                        %td
                        %td
                        %th
                        %td 
                        %td
                        %td
                        %td 
                          .text-primary.font-weight-s
                            = format_currency(@inhouse_loan.balance)
                        %td 
                      - total_principal = 0
                      - total_interest = 0
                      - @inhouse_loan.inhouse_loan_items.order("due_date asc").each do |ai|
                        %tr
                          %td 
                            = ai.term
                          %td 
                            = ai.due_date.strftime("%b %d %Y")
                          %td
                            = ai.payment_date ? ai.payment_date.strftime("%b %d %Y") : ''
                          %td
                            = ai.or
                          %td
                            = number_to_currency(ai.paid_amount, unit: "₱ ", precision: 2, format: "%u%n")
                          %td
                            = number_to_currency(ai.advance, unit: "₱ ", precision: 2, format: "%u%n")
                          %td
                            = number_to_currency(ai.monthly_amort, unit: "₱ ", precision: 2, format: "%u%n")
                          %td
                            = number_to_currency(ai.penalty, unit: "₱ ", precision: 2, format: "%u%n")
                          %td
                            = number_to_currency(ai.interest, unit: "₱ ", precision: 2, format: "%u%n")
                            - total_interest += ai.interest
                          %td
                            = number_to_currency(ai.principal, unit: "₱ ", precision: 2, format: "%u%n")
                            - total_principal += ai.principal                    
                          %td
                            = number_to_currency(ai.balance, unit: "₱ ", precision: 2, format: "%u%n")
                          %td
                            .badges
                              - if ai.is_paid == true
                                <span class="badge bg-success">Paid</span>
                              - else
                                <span class="badge bg-info">Unpaid</span>
                      %tr
                        %td
                          %strong.hidden= @inhouse_loan.inhouse_loan_items.count+1
                        %td
                          Total
                        %td
                        %td
                        %td
                        %td
                        %td
                        %td
                        %td
                          = number_to_currency(total_interest, unit: "₱ ", precision: 2, format: "%u%n")
                        %td
                          = number_to_currency(total_principal, unit: "₱ ", precision: 2, format: "%u%n")
                        %td
                        %td
                        %td
