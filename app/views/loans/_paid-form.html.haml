
= form_for 'paid_loan', url: process_paid_loan_loans_path, html: { id: 'paid_loan' } do |f|
  .row.m-t-sm
    .col-md-4
      = f.label "Paid Loan?", :class => "form-label"
      = f.text_field :is_paid, value: true, class: 'form-control', required:  true, readonly: true
  .row.m-t-sm
    .col-md-6
      = f.label :client_id, :class => "form-label"
      = f.select :client_id, options_for_select(Client.all.order(:name).collect{ |u| [u.name, u.id]}),{ include_blank: 'Select Client' }, :class=>"form-control"
    .col-md-6
      = f.label :blocklot, :class => "form-label"
      = f.select :blocklot, options_for_select(@parcels),  {}, { class: 'form-control js-example-tokenizer ', multiple: true}
  
  .row.m-t-sm
    .col-md-12
      = f.label :remarks, :class => "form-label"
      = f.text_area :remarks, class: 'form-control'     

  .mt-4
    = link_to 'Back', loans_path, class: 'btn btn-dark'
    = f.submit 'Save Changes', class: 'btn btn-primary float-right'

:javascript
  $(document).ready(function(){
    $(".js-example-tokenizer").select2({
      tags: true,
      tokenSeparators: [',', ' ']
    });
    $('select').select2({
      createTag: function (params) {
        // Don't offset to create a tag if there is no @ symbol
        if (params.term.indexOf('@') === -1) {
          // Return null to disable tag creation
          return null;
        }

        return {
          id: params.term,
          text: params.term
        }
      }
    });
    $('select').select2({
      createTag: function (params) {
        var term = $.trim(params.term);

        if (term === '') {
          return null;
        }

        return {
          id: term,
          text: term,
          newTag: true // add additional parameters
        }
      }
    });
  });
  function contract_price_total(){
    const contractPrice = parseFloat($("#parcel_contract_price").val()) || 0;
    $.ajax({
      url: "/parcel/get_contract_price_data", // this will be routed
      type: 'GET',
      data: {
        data: { contract_price: contractPrice },
      },
      async: true,
      dataType: "json",
      error: function(XMLHttpRequest, errorTextStatus, error){
          alert("Failed: "+ errorTextStatus+" ;"+error);
      },
      success: function(ret){
          $("#loan_selling_price").val(response.selling_price);
      }
    });
  }

  function get_selling_price(){
    console.log($("#loan_blocklot").val())
    if($("#loan_blocklot").val() == []){
      $("#loan_contract_price").val(0)
    }else{
      $.ajax({
        url: "/loans/check_parcel_price",
        type: 'GET',
        data: {
          id: $("#loan_blocklot").val()
        },
        async: true,
        dataType: "json",
        error: function(XMLHttpRequest, errorTextStatus, error){
            alert("Failed: "+ errorTextStatus+" ;"+error);
        },
        success: function(ret){
            // here we iterate the json result
            console.log(ret)
            $("#loan_contract_price").val(ret)
        }
      });
    }
    
  }