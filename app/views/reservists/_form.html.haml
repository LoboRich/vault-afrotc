= form_with(model: reservist) do |form|
  - if reservist.errors.any?
    %div{style: "color: red"}
      %h2= "#{pluralize(reservist.errors.count, "error")} prohibited this reservist from being saved:"

      %ul
        - reservist.errors.each do |error|
          %li= error.full_message
  .container.gap-3.d-flex.flex-column
    .row
      .col-md-3
        %div
          = form.label :rank
          = form.text_field :rank, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :last_name
          = form.text_field :last_name, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :first_name
          = form.text_field :first_name, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :middle_name
          = form.text_field :middle_name, class: "form-control", required: true
    .row
      .col-md-3
        %div
          = form.label :branch_of_service
          = form.text_field :branch_of_service, class: "form-control", required: true
          -# dropdown field (Navy, Air Force, Army)
      .col-md-3
        %div
          = form.label :afpsn
          = form.text_field :afpsn, class: "form-control", required: true
      .col-md-2
        %div
          = form.label :primary_afsc
          = form.text_field :primary_afsc, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :duty_afsc
          = form.text_field :duty_afsc, class: "form-control", required: true
    .row
      .col-md-6
        %div
          = form.label :other_skills
          = form.text_area :other_skills, class: "form-control", required: true

    .row
      .col-md-3
        %div
          = form.label :source_of_enlistment
          = form.text_field :source_of_enlistment, class: "form-control", required: true
      .col-md-3
        %div
          = form.label "authority"
          = form.text_field :soe_authority, class: "form-control", required: true
      .col-md-3
        %div
          = form.label "date of enlistment"
          = form.date_field :soe_date_of_enlistment, class: "form-control", required: true
      .col-md-3
        %div
          = form.label "initial rank"
          = form.text_field :soe_initial_rank, class: "form-control", required: true
    .row
      .col-md-3
        %div
          = form.label :source_of_commission
          = form.text_field :source_of_commission, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :soc_authority
          = form.text_field :soc_authority, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :soc_date_of_enlistment
          = form.date_field :soc_date_of_enlistment, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :soc_initial_rank
          = form.text_field :soc_initial_rank, class: "form-control", required: true
    .row
      .col-md-4
        %div
          = form.label :reservist_classification
          = form.text_field :reservist_classification, class: "form-control", required: true
      .col-md-4
        %div
          = form.label :classification_authority
          = form.text_field :classification_authority, class: "form-control", required: true
      .col-md-4
        %div
          = form.label :date_of_classification
          = form.date_field :date_of_classification, class: "form-control", required: true
    .row
      .col-md-4
        %div
          = form.label :reserve_unit_assignment
          = form.text_field :reserve_unit_assignment, class: "form-control", required: true
      .col-md-4
        %div
          = form.label :date_assigned
          = form.date_field :date_assigned, class: "form-control", required: true
      .col-md-4
        %div
          = form.label :unit_capability
          = form.text_field :unit_capability, class: "form-control", required: true

    .row
      .col-md-6
        %div
          = form.label :present_designation
          = form.text_field :present_designation, class: "form-control", required: true
      .col-md-6
        %div
          = form.label :mobilization_center
          = form.text_field :mobilization_center, class: "form-control", required: true

    .row
      .col-md-3
        %div
          = form.label :street_address
          = form.text_field :street_address, class: "form-control", required: true
      .col-md-2
        %div
          = form.label :city
          = form.text_field :city, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :province
          = form.text_field :province, class: "form-control", required: true
      .col-md-2
        %div
          = form.label :zip_code
          = form.text_field :zip_code, class: "form-control", required: true
      .col-md-2
        %div
          = form.label :region
          = form.text_field :region, class: "form-control", required: true
    .row
      .col-md-3
        %div
          = form.label :date_of_birth
          = form.date_field :date_of_birth, class: "form-control", required: true
      .col-md-2
        %div
          = form.label :age
          = form.number_field :age, class: "form-control", required: true
      .col-md-7
        %div
          = form.label :place_of_birth
          = form.text_field :place_of_birth, class: "form-control", required: true
    .row
      .col-md-3 
        %div
          = form.label :email
          = form.text_field :email, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :residence_tel
          = form.text_field :residence_tel, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :office_tel
          = form.text_field :office_tel, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :mobile_nr
          = form.text_field :mobile_nr, class: "form-control", required: true
    .row
      .col-md-3
        %div
          = form.label :ethnic_group
          = form.text_field :ethnic_group, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :sex
          = form.text_field :sex, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :marital_status
          = form.text_field :marital_status, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :religion
          = form.text_field :religion, class: "form-control", required: true
    .row
      .col-md-2
        %div
          = form.label :blood_type
          = form.text_field :blood_type, class: "form-control", required: true
      .col-md-2
        %div
          = form.label :eye_color
          = form.text_field :eye_color, class: "form-control", required: true
      .col-md-2
        %div
          = form.label :hair_color
          = form.text_field :hair_color, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :complexion
          = form.text_field :complexion, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :identifying_marks
          = form.text_field :identifying_marks, class: "form-control", required: true
    .row 
      .col-md-3
        %div
          = form.label :height_cm
          = form.number_field :height_cm, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :weight_kg
          = form.number_field :weight_kg, class: "form-control", required: true
    .row 
      .col-md-2
        %div
          = form.label :tin
          = form.text_field :tin, class: "form-control", required: true
      .col-md-2
        %div
          = form.label :sss_number
          = form.text_field :sss_number, class: "form-control", required: true
      .col-md-2
        %div
          = form.label :gsis_number
          = form.text_field :gsis_number, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :philhealth_number
          = form.text_field :philhealth_number, class: "form-control", required: true
      .col-md-3
        %div
          = form.label :pagibig_number
          = form.text_field :pagibig_number, class: "form-control", required: true
    .row
      .col-md-6
        %div
          = form.label :dialects_spoken
          = form.text_area :dialects_spoken, class: "form-control", required: true
    .col-md-12.pt-3
      .field
        = form.label :location
        = form.text_field :location, class: 'form-control', required:  true, placeholder: "Enter address",data: { controller: "reservist-location" }
    .col-md-12.pt.3 
      %div#autocomplete-results.list-group.position-absolute.w-100
    .col-md-6.pt-3
      .field
        = form.hidden_field :lat, class: 'form-control', required:  true
    .col-md-6.pt-3
      .field
        = form.hidden_field :long, class: 'form-control', required:  true
    .row
      .col-md-12
        %div
          -# = form.text_field :lat,  data: { reservist_map_target: "lat" }
          -# = form.text_field :long, data: { reservist_map_target: "lng" }
          -# %div{ data: { controller: "reservist-map", "reservist-map-target": "map" }, style: "height: 400px; width: 100%;" }
      
    .d-flex.justify-content-end
      = button_tag "Register",
        type: "button",
        class: "btn btn-primary btn-round mt-3 btn-lg",
        id: "registerBtn"



  .modal.fade#privacyModal{ tabindex: "-1", aria: { hidden: "true" } }
    .modal-dialog.modal-dialog-centered
      .modal-content
        .modal-header
          %h5.modal-title Data Privacy Notice
          %button.btn-close{ type: "button", data: { bs_dismiss: "modal" }, aria: { label: "Close" } }

        .modal-body.gap-2
          %p
            By registering and using this system, you acknowledge and agree to the following Data Privacy Terms and Conditions in accordance with Republic Act No. 10173, otherwise known as the Data Privacy Act of 2012, and its Implementing Rules and Regulations:
          %p
            Collection of Personal Information
            The system may collect personal information such as, but not limited to, your name, contact details, organizational affiliation, and other information necessary for system access and research purposes.
          %p
            Purpose of Data Collection
            Personal data collected shall be used solely for legitimate purposes, including system administration, research analysis, reporting, and improvement of system functionality. Data shall not be used for purposes inconsistent with those stated without prior consent.
          %p
            Consent and Voluntary Participation
            By clicking “I Agree,” you voluntarily provide your informed consent to the collection, use, and processing of your personal data. You understand that providing consent is optional and that you may withdraw your consent at any time, subject to applicable laws and institutional policies.
          %p
            Data Storage and Protection
            All personal data shall be stored in secure systems and protected through appropriate organizational, physical, and technical security measures to prevent unauthorized access, disclosure, alteration, or loss.
          %p
            Confidentiality and Anonymity
            The researchers shall ensure that personal identifiers are removed or anonymized in research outputs. Your identity shall not be disclosed in any reports, publications, or presentations.
          %p
            Data Retention and Disposal
            Personal data shall be retained only for as long as necessary to fulfill the stated purposes or as required by law. After the retention period, data shall be securely disposed of in accordance with data protection policies.
          %p
            Data Subject Rights
            In accordance with RA 10173, you have the right to be informed, to access, to object, to erasure or blocking, to damages, to data portability, and to lodge a complaint before the National Privacy Commission.
          %p
            Third-Party Disclosure
            Personal data shall not be shared with third parties without your consent, except when required by law or authorized by the National Privacy Commission or other lawful authorities.
          %p
            Amendments to the Privacy Policy
            The researchers reserve the right to update these Data Privacy Terms and Conditions as necessary. Any material changes shall be communicated through the system.
          %p
            Contact Information
            For questions, concerns, or requests regarding your personal data, you may contact the designated Data Protection Officer or system administrator.

        .modal-footer
          %button.btn.btn-secondary{ type: "button", data: { bs_dismiss: "modal" } }
            Cancel
          %button.btn.btn-primary#confirm-submit
            I Agree & Submit

:javascript
  document.addEventListener("DOMContentLoaded", () => {
    const registerBtn = document.getElementById("registerBtn");

    registerBtn.addEventListener("click", () => {
      const requiredFields = document.querySelectorAll(
        "input[required], select[required], textarea[required]"
      );

      let allValid = true;

      requiredFields.forEach(field => {
        if (!field.value.trim()) {
          field.classList.add("is-invalid");
          allValid = false;
        } else {
          field.classList.remove("is-invalid");
        }
      });

      if (!allValid) {
        alert("Please fill in all required fields before continuing.");
        return;
      }

      // ✅ All good → open modal manually
      const modal = new bootstrap.Modal(
        document.getElementById("privacyModal")
      );
      modal.show();
    });
  });

