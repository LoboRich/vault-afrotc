
.app.align-content-stretch.d-flex.flex-wrap
  .app-sidebar
    = render "layouts/sidebar"
  .app-container
    .app-content
      .content-wrapper
        .container
          .page-description.d-flex.align-items-center
            .page-description-content.flex-grow-1
              %h1 Inventory Information
          .row
            .card
              .card-body
                = form_for @parcel do |f|
                  - if @parcel.errors.any?
                    #error_explanation
                      %h2= "#{pluralize(@parcel.errors.count, "error")} prohibited this parcel from being saved:"
                      %ul
                        - @parcel.errors.full_messages.each do |message|
                          %li= message
                  .row.m-t-sm
                    .col-md-6
                      = f.label :subdivision, :class => "form-label"
                      = f.text_field :subdivision, class: 'form-control', required:  true, disabled: true, value: @parcel.subdivision.name
                    .col-md-6
                      = f.label :selling_price, :class => "form-label"
                      = f.number_field :selling_price, class: 'form-control', disabled: true
                  .row.m-t-sm
                    .col-md-6
                      = f.label :lot, :class => "form-label"
                      = f.text_field :lot, class: 'form-control', required:  true, disabled: true
                    .col-md-6
                      = f.label :block, :class => "form-label"
                      = f.text_field :block, class: 'form-control', required:  true, disabled: true
                  .row.m-t-sm
                    .col-md-6
                      = f.label :lot_area, :class => "form-label"
                      = f.text_field :lot_area, class: 'form-control', disabled: true
                    .col-md-6
                      = f.label :house_area, :class => "form-label"
                      = f.text_field :house_area, class: 'form-control', disabled: true
                  .row.m-t-sm
                    .col-md-6
                      = f.label :status, :class => "form-label"
                      = f.text_field :status, class: 'form-control', required:  true, disabled: true
                    .col-md-6
                      = f.label :description, :class => "form-label"
                      = f.text_area :description, class: 'form-control', disabled: true
                  .m-t-xxl
                    = link_to 'Back', parcels_path, :class => "btn btn-dark"
                  - if admin_or_ceo?
                    = link_to 'Edit', edit_parcel_path(@parcel), :class => "btn btn-primary p-h-xxl"
                    
        .container
          .page-description.d-flex.align-items-center
            .page-description-content.flex-grow-1
              %h1 Purchasers
            .page-description-actions
              = link_to new_purchaser_parcel_path(@parcel), class: 'btn btn-primary' do
                %i.material-icons> add
                Purchaser
          .row

            - budget_total = 0
            - expenses = 0

            .table-responsive.col-sm-12
              %table#datatable_waterbill.display.dataTable{"aria-describedby" => "datatable1_info", :role => "grid", :style => "width: 100%;"}
                %thead
                  %tr{:role => "row"}
                    %th.sorting_asc{"aria-controls" => "datatable1", "aria-label" => "Name: activate to sort column descending", "aria-sort" => "ascending", :colspan => "1", :rowspan => "1", :style => "width: 208px;", :tabindex => "0"} Name
                    %th.sorting{"aria-controls" => "datatable1", "aria-label" => "Position: activate to sort column ascending", :colspan => "1", :rowspan => "1", :style => "width: 304px;", :tabindex => "0"} Budget
                    %th.sorting{"aria-controls" => "datatable1", "aria-label" => "Office: activate to sort column ascending", :colspan => "1", :rowspan => "1", :style => "width: 159px;", :tabindex => "0"} Expense
                    %th.sorting{"aria-controls" => "datatable1", "aria-label" => "Office: activate to sort column ascending", :colspan => "1", :rowspan => "1", :style => "width: 159px;", :tabindex => "0"} Date started
                    %th.sorting{"aria-controls" => "datatable1", "aria-label" => "Office: activate to sort column ascending", :colspan => "1", :rowspan => "1", :style => "width: 159px;", :tabindex => "0"} Deadline
                    %th.sorting{"aria-controls" => "datatable1", "aria-label" => "Age: activate to sort column ascending", :colspan => "1", :rowspan => "1", :style => "width: 58px;", :tabindex => "0"} Status
                    %th.sorting{"aria-controls" => "datatable1", "aria-label" => "Age: activate to sort column ascending", :colspan => "1", :rowspan => "1", :style => "width: 58px;", :tabindex => "0"} Remarks
                    %th.sorting{"aria-controls" => "parcel_table", "aria-label" => "Action: activate to sort column ascending", :colspan => "1", :rowspan => "1", :style => "width: 66px;", :tabindex => "0"} Action
                %tbody
                  - @purchasers.each do |purchaser|
                    - budget_total += purchaser.budget.to_f
                    - expenses += purchaser.expense.to_f
                    %tr.odd{:role => "row"}
                      %td= 'Milestone ' + purchaser.name
                      %td= purchaser.budget
                      %td= purchaser.expense
                      %td= purchaser.date_started
                      %td= purchaser.deadline
                      %td= purchaser.status
                      %td= purchaser.remarks
                      %td
                        .d-flex
                          = link_to purchaser, class: 'btn btn-action btn-info' do
                            %i.material-icons> visibility
                          - if current_user.role == 'admin' || current_user.role == 'ceo'
                            = link_to edit_purchaser_path(purchaser), class: 'btn btn-action btn-warning' do
                              %i.material-icons> edit
                          
                            = button_to purchaser_path(purchaser), class: 'btn btn-action btn-danger', method: :delete, data: { confirm: 'Are you sure?', remote: true } do
                              %i.material-icons delete
                  %h4= "Total Budget: #{budget_total}"
                  %h4= "Total Expenses: #{expenses}"
:javascript
  $(document).ready( function () {
      $('#datatable_waterbill').DataTable();
  } );